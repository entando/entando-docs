(window.webpackJsonp=window.webpackJsonp||[]).push([[824],{2156:function(e,t,a){"use strict";a.r(t);var s=a(36),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"use-environment-variables-to-customize-microservices"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#use-environment-variables-to-customize-microservices"}},[e._v("#")]),e._v(" Use Environment Variables to Customize Microservices")]),e._v(" "),a("p",[e._v("This tutorial describes how to use environment variables to customize the behavior of microservices. Using environment variables as a configuration mechanism allows the same Linux image to run in development and production environments. This is especially useful when managing sensitive information via Kubernetes Secrets.")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("entando.json")]),e._v(" file makes environment variables available to a microservice in a docker-based bundle. There are two options:")]),e._v(" "),a("ol",[a("li",[e._v("Inject the variables using a key-value pair")]),e._v(" "),a("li",[e._v("Inject a reference to an existing Kubernetes Secret")])]),e._v(" "),a("p",[e._v("This tutorial will demonstrate both of these options. The microservice will receive one environment value directly as plain text in the pod YAML and the other indirectly through a referenced Secret.")]),e._v(" "),a("h2",{attrs:{id:"prerequisites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),a("ul",[a("li",[a("RouterLink",{attrs:{to:"/v7.2/tutorials/create/ms/generate-microservices-and-micro-frontends.html"}},[e._v("A bundle project using the latest Entando Blueprint")])],1)]),e._v(" "),a("h2",{attrs:{id:"add-environment-variables-to-the-microservice"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#add-environment-variables-to-the-microservice"}},[e._v("#")]),e._v(" Add Environment Variables to the Microservice")]),e._v(" "),a("ol",[a("li",[e._v("To determine YOUR-BUNDLE-ID, run the following command. Supply the full bundle URL, remembering to update the placeholders with your Docker organization and your bundle name.")])]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("ent ecr get-bundle-id docker://registry.hub.docker.com/YOUR-ORG/YOUR-BUNDLE\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[e._v("Create a Secret named "),a("code",[e._v("YOUR-BUNDLE-ID-my-secret")]),e._v(" with key-value pair "),a("code",[e._v("mySecretKey=mySecretValue")]),e._v(". Replace YOUR-BUNDLE-ID with the output of the previous step.")])]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("ent kubectl create secret generic YOUR-BUNDLE-ID-my-secret --from-literal"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("mySecretKey"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("mySecretValue -n entando\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[e._v("Insert the following "),a("code",[e._v("env")]),e._v(" section into the microservice in "),a("code",[e._v("entando.json")]),e._v(", remembering to replace YOUR-BUNDLE-ID. By convention, environment variables are all caps and K8s resource names are hyphenated.")])]),e._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"env"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"SIMPLE_VAR"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"value"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"mySimpleValue"')]),e._v(" \n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"SECRET_VAR"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"secretKeyRef"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"YOUR-BUNDLE-ID-my-secret"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" \n        "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"key"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"mySecretKey"')]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[a("RouterLink",{attrs:{to:"/v7.2/tutorials/create/pb/publish-project-bundle.html"}},[e._v("Build and deploy")]),e._v(" the updated bundle")],1)]),e._v(" "),a("h2",{attrs:{id:"verify-the-environment-variables"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#verify-the-environment-variables"}},[e._v("#")]),e._v(" Verify the Environment Variables")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Retrieve your microservice pod name. Use "),a("code",[e._v("ent kubectl get pods")]),e._v(" or your cluster management tool to find the name.")]),e._v(" "),a("p",[e._v("The pod name begins with 'pn', followed by two generated alpha-numeric strings, your docker organization name, microservice name, etc."),a("br"),e._v("\nE.g. YOUR-MICROSERVICE-POD-NAME = "),a("code",[e._v("pn-ccfcefa6-615bc3ba-dockerorg-conference-ms-deploymentvpsgj")])])]),e._v(" "),a("li",[a("p",[e._v("Shell into the pod, using the name from above:")])])]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("ent kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it YOUR-MICROSERVICE-POD-NAME -- /bin/bash\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[e._v("Confirm the environment variables are present:")])]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("SIMPLE_VAR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$SIMPLE_VAR")]),e._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("SECRET_VAR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$SECRET_VAR")]),e._v("\n")])])]),a("p",[e._v("Expected output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("SIMPLE_VAR=mySimpleValue, SECRET_VAR=mySecretValue\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("Congratulations!")]),e._v(" "),a("p",[e._v("You have learned how to use environment variables with microsevices on the Entando Platform!")])])])}),[],!1,null,null,null);t.default=r.exports}}]);