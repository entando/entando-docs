(window.webpackJsonp=window.webpackJsonp||[]).push([[380],{1501:function(e,t,a){"use strict";a.r(t);var n=a(36),s=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"multitenancy-on-entando"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#multitenancy-on-entando"}},[e._v("#")]),e._v(" Multitenancy on Entando")]),e._v(" "),a("p",[e._v("This tutorial describes how to configure Entando to serve multiple tenants. The primary tenant is configured first, then secondary tenants can be added. See "),a("RouterLink",{attrs:{to:"/next/docs/consume/multitenancy.html"}},[e._v("Multitenancy on Entando")]),e._v(" for details on concepts and architecture.")],1),e._v(" "),a("h2",{attrs:{id:"prerequisites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),a("ul",[a("li",[a("RouterLink",{attrs:{to:"/next/docs/getting-started/"}},[e._v("A working instance of Entando 7.2 or higher")]),e._v(" based on the Tomcat server image. This is the default "),a("code",[e._v("standardServerImage")]),e._v(" for the "),a("code",[e._v("EntandoApp")]),e._v(" custom resource.")],1)]),e._v(" "),a("h2",{attrs:{id:"configure-the-primary-tenant"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-primary-tenant"}},[e._v("#")]),e._v(" Configure the Primary Tenant")]),e._v(" "),a("p",[e._v("The primary tenant is configured with services for the content delivery server (CDS), cache management, and search capability. Follow the links below to complete the setup.")]),e._v(" "),a("ol",[a("li",[a("p",[a("RouterLink",{attrs:{to:"/next/tutorials/consume/cds.html"}},[e._v("Install and enable the Entando Content Delivery Server (CDS)")]),e._v(" to manage static resources.")],1)]),e._v(" "),a("li",[a("p",[a("RouterLink",{attrs:{to:"/next/tutorials/consume/redis.html"}},[e._v("Install and enable Redis")]),e._v(" to handle caching and clustering.")],1)]),e._v(" "),a("li",[a("p",[a("RouterLink",{attrs:{to:"/next/tutorials/consume/solr.html"}},[e._v("Install and enable Solr integration")]),e._v(" to enable enterprise search.")],1)])]),e._v(" "),a("h2",{attrs:{id:"configure-the-secondary-tenant"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-secondary-tenant"}},[e._v("#")]),e._v(" Configure the Secondary Tenant")]),e._v(" "),a("p",[e._v("For each secondary tenant, you will need to configure Keycloak, CDS, Solr, and a database schema. Then the ingress and a shared configuration Secret is created, after which the Entando App Engine is modified to read that Secret.")]),e._v(" "),a("h4",{attrs:{id:"definitions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#definitions"}},[e._v("#")]),e._v(" Definitions")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[e._v("Placeholder")]),e._v(" "),a("th",{staticStyle:{"text-align":"left"}},[e._v("Description")])])]),e._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("YOUR-APP-NAME")]),e._v(" "),a("td",{staticStyle:{"text-align":"left"}},[e._v("The name of the application, e.g., quickstart")])]),e._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("YOUR-HOST-NAME")]),e._v(" "),a("td",{staticStyle:{"text-align":"left"}},[e._v("The base host name of the application, e.g., your-domain.com")])]),e._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("YOUR-TENANT-NAME")]),e._v(" "),a("td",{staticStyle:{"text-align":"left"}},[e._v("The identifying name of the current tenant. In most cases, it will also be used to determine the base URL of the tenant. For example, yoursite results in yoursite.your-domain.com.")])]),e._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("YOUR-NAMESPACE")]),e._v(" "),a("td",{staticStyle:{"text-align":"left"}},[e._v("The Kubernetes namespace in which your app is running")])])])]),e._v(" "),a("h3",{attrs:{id:"keycloak"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keycloak"}},[e._v("#")]),e._v(" Keycloak")]),e._v(" "),a("p",[e._v("Each tenant requires its own Keycloak realm. Create the tenant-specific realm in the standard Entando-deployed Keycloak instance.")]),e._v(" "),a("ol",[a("li",[a("RouterLink",{attrs:{to:"/next/tutorials/devops/backing-restoring-keycloak.html"}},[e._v("Create a Backup of the Keycloak Realm")])],1),e._v(" "),a("li",[e._v("Remove the "),a("code",[e._v("id")]),e._v(" attributes so Keycloak will recognize the data as new entries upon importing:")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sed")]),e._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("''")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('\'/"id" : "/ d\'')]),e._v(" keycloak-realm.json\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[e._v("Replace the "),a("code",[e._v("realm")]),e._v(" and "),a("code",[e._v("displayName")]),e._v(" properties with YOUR-TENANT-NAME. Note: supply the original realm name if it was not named "),a("code",[e._v("entando")]),e._v(".")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sed")]),e._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("''")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('\'s/"entando"/"YOUR-TENANT-NAME"/g\'')]),e._v(" keycloak-realm.json\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[e._v("Update the values of "),a("code",[e._v("redirectUris")]),e._v(" and "),a("code",[e._v("webOrigins")]),e._v(" to use YOUR-TENANT-NAME:")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sed")]),e._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("''")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'s/\\/\\/YOUR-APP-NAME\\./\\/\\/YOUR-TENANT-NAME\\.YOUR-APP-NAME\\./g'")]),e._v(" keycloak-realm.json\n")])])]),a("blockquote",[a("p",[e._v("This should transform the URIs from "),a("code",[e._v("http(s)://YOUR-APP-NAME.YOUR-HOST-NAME")]),e._v(" to "),a("code",[e._v("http(s)://YOUR-TENANT-NAME.YOUR-APP-NAME.YOUR-HOST-NAME")]),e._v(".")])]),e._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[a("p",[e._v("Log in to your "),a("RouterLink",{attrs:{to:"/next/docs/consume/identity-management.html#authorization"}},[e._v("Keycloak admin console")]),e._v(".")],1)]),e._v(" "),a("li",[a("p",[e._v("Go to "),a("code",[e._v("Select realm")]),e._v(" in the top left nav → "),a("code",[e._v("Add Realm")]),e._v(" → select your keycloak-realm.json file. Click "),a("code",[e._v("Create")]),e._v(".")])]),e._v(" "),a("li",[a("p",[e._v("In the new realm, go to "),a("code",[e._v("Clients")]),e._v(" → Click the Client ID with "),a("code",[e._v("YOUR-APP_NAME")]),e._v(". Under the "),a("code",[e._v("Credentials")]),e._v(" tab, regenerate the "),a("code",[e._v("Secret")]),e._v(".")])])]),e._v(" "),a("blockquote",[a("p",[e._v("Note: The Secret for this client will be needed in the "),a("code",[e._v("entando-tenants-secret.yaml")]),e._v(" for the property "),a("code",[e._v("kcClientSecret")]),e._v(" value "),a("code",[e._v("YOUR-TENANT-KC-SECRET")]),e._v(" below.")])]),e._v(" "),a("ol",{attrs:{start:"8"}},[a("li",[e._v("Regenerate the Secret for Client ID "),a("code",[e._v("YOUR-APP-NAME-de")]),e._v(".")])]),e._v(" "),a("blockquote",[a("p",[e._v("Note: The Secret for this client is also required in the "),a("code",[e._v("entando-tenants-secret.yaml")]),e._v(", for the property "),a("code",[e._v("deKcClientSecret")]),e._v(" value "),a("code",[e._v("YOUR-KEYCLOAK-CLIENT-SECRET")]),e._v(" below.")])]),e._v(" "),a("ol",{attrs:{start:"9"}},[a("li",[a("p",[e._v("Go to "),a("code",[e._v("Manage")]),e._v(" → "),a("code",[e._v("Users")]),e._v(". Click "),a("code",[e._v("View all users")]),e._v(" and choose the "),a("code",[e._v("admin")]),e._v(" user. Go to "),a("RouterLink",{attrs:{to:"/next/docs/consume/identity-management.html#authorization"}},[e._v("Role Mapping")]),e._v(" and make this assignment: Client "),a("code",[e._v("realm-management")]),e._v(" and Role "),a("code",[e._v("manage-realm")]),e._v(".")],1)]),e._v(" "),a("li",[a("p",[e._v("(Optional) Go to "),a("code",[e._v("Credentials")]),e._v(" and reset the password for the "),a("code",[e._v("admin")]),e._v(" user.")])])]),e._v(" "),a("h3",{attrs:{id:"content-delivery-server-cds"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#content-delivery-server-cds"}},[e._v("#")]),e._v(" Content Delivery Server (CDS)")]),e._v(" "),a("p",[e._v("Each tenant requires its own set of CDS resources. Follow the "),a("RouterLink",{attrs:{to:"/next/tutorials/consume/cds.html"}},[e._v("CDS tutorial")]),e._v(" to prepare these resources for each secondary tenant.")],1),e._v(" "),a("h3",{attrs:{id:"solr"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#solr"}},[e._v("#")]),e._v(" Solr")]),e._v(" "),a("p",[e._v("Each tenant requires a dedicated Solr core or collection. Follow the "),a("RouterLink",{attrs:{to:"/next/tutorials/consume/solr.html#generate-the-core"}},[e._v("Solr tutorial")]),e._v(" to generate the core and schema for each secondary tenant.")],1),e._v(" "),a("h3",{attrs:{id:"database"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#database"}},[e._v("#")]),e._v(" Database")]),e._v(" "),a("p",[e._v("Each tenant requires a new database schema for the Entando tables related to the page structure, web content, widgets, etc. The following steps provide a way to export the schemas in a default installation using the Entando-generated PostgreSQL instance. The exact commands will differ for external databases and other DBMS.")]),e._v(" "),a("ol",[a("li",[e._v("Determine the name of your PostgreSQL pod (YOUR-POSTGRESQL-POD):")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl get pods "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("grep")]),e._v(" postgres\n")])])]),a("p",[e._v("Example:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("default-postgresql-dbms-in-namespace-deployment-54bb664745lxllh\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[e._v("Determine the names of the three source schemas:")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it YOUR-POSTGRESQL-POD -- psql -d default_postgresql_dbms_in_namespace_db -c "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("\"SELECT schema_name FROM information_schema.schemata WHERE schema_name LIKE '%portdb%' OR schema_name LIKE '%servdb%' OR schema_name LIKE '%dedb%';\"")]),e._v("\n")])])]),a("p",[e._v("Example:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" quickstart_portdb_90419\n quickstart_servdb_90314\n quickstart_dedb_9472\n")])])]),a("p",[e._v("Use these values for YOUR-SCHEMA-1, YOUR-SCHEMA-2, and YOUR-SCHEMA-3 in the following steps.")]),e._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[e._v("Export the schemas:")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it YOUR-POSTGRESQL-POD -- pg_dump -O -n YOUR-SCHEMA-1 -n YOUR-SCHEMA-2 -n YOUR-SCHEMA-3 default_postgresql_dbms_in_namespace_db "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" db_export.sql\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[e._v("Replace the schema names in the export file:")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sed")]),e._v(" -i"),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("''")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'s/YOUR-SCHEMA-1/YOUR-TENANT-NAME/g; s/YOUR-SCHEMA-2/YOUR-TENANT-NAME/g; s/YOUR-SCHEMA-3/YOUR-TENANT-NAME/g'")]),e._v(" db_export.sql\n")])])]),a("p",[a("strong",[e._v("Note:")]),e._v(" The default Entando implementation used for the primary tenant has two schemas (portdb and servdb) but these are combined into a single schema for secondary tenants.")]),e._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[e._v("Import the new schema into PostgreSQL:")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it YOUR-POSTGRESQL-POD -- psql -d default_postgresql_dbms_in_namespace_db "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" db_export.sql\n")])])]),a("ol",{attrs:{start:"6"}},[a("li",[e._v("Truncate the Liquibase-managed log lock table to avoid issues with schema updates:")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it YOUR-POSTGRESQL-POD -- psql -d default_postgresql_dbms_in_namespace_db -c "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"TRUNCATE YOUR-TENANT-NAME.databasechangeloglock;"')]),e._v("\n")])])]),a("h3",{attrs:{id:"tenant-configurations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tenant-configurations"}},[e._v("#")]),e._v(" Tenant Configurations")]),e._v(" "),a("h4",{attrs:{id:"tenant-ingress"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tenant-ingress"}},[e._v("#")]),e._v(" Tenant Ingress")]),e._v(" "),a("ol",[a("li",[e._v("Download the template "),a("code",[e._v("entando-tenant-ingress.yaml")]),e._v(":")])]),e._v(" "),a("EntandoCode",[e._v('curl -sLO "https://raw.githubusercontent.com/entando/entando-releases/'+e._s(e.$site.themeConfig.entando.fixpack.v73)+'/dist/ge-1-1-6/samples/entando-tenant-ingress.yaml"')]),e._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[e._v("Create an ingress for your primary and each of your secondary tenants. Replace the placeholders with the appropriate values for each tenant. Remember, YOUR-TENANT-NAME will change for each ingress you create.\n"),a("ul",[a("li",[e._v("For every secondary tenant, add the following snippet with its tenant name under "),a("code",[e._v("metadata.labels")]),e._v(":"),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("EntandoTenant")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" YOUR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("TENANT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("NAME\n")])])])])])]),e._v(" "),a("li",[e._v("Apply each Ingress with the following command:")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl apply -f YOUR-TENANT-NAME-INGRESS.yaml -n YOUR-NAMESPACE\n")])])]),a("h4",{attrs:{id:"tenant-configuration-secret"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tenant-configuration-secret"}},[e._v("#")]),e._v(" Tenant Configuration Secret")]),e._v(" "),a("p",[e._v("A single Secret needs to be defined with the configuration for each of the tenants. If the "),a("code",[e._v("entando-tenants-secret.yaml")]),e._v(" already exists, then it should be edited with the addition of a new JSON block for the tenant.")]),e._v(" "),a("ol",[a("li",[e._v("Download the template "),a("code",[e._v("entando-tenants-secret.yaml")]),e._v(":")])]),e._v(" "),a("EntandoCode",[e._v('curl -sLO "https://raw.githubusercontent.com/entando/entando-releases/'+e._s(e.$site.themeConfig.entando.fixpack.v73)+'/dist/ge-1-1-6/samples/entando-tenants-secret.yaml"')]),e._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[e._v("Replace the placeholders with the appropriate values for each of your tenants.")])]),e._v(" "),a("li",[a("p",[e._v("Create the Secret:")])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("kubectl apply -f entando-tenant-secret.yaml -n YOUR-NAMESPACE\n")])])]),a("h3",{attrs:{id:"configure-the-entandoapp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-entandoapp"}},[e._v("#")]),e._v(" Configure the EntandoApp")]),e._v(" "),a("p",[e._v("The EntandoApp has to be configured just once to point to the "),a("code",[e._v("entando-tenants-secret.yaml")]),e._v(". When additional tenants are added, the EntandoApp deployment only needs to be restarted.")]),e._v(" "),a("ol",[a("li",[e._v("Scale down the EntandoApp deployment to 0:")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("kubectl scale deploy/YOUR-APP-NAME-deployment --replicas=0 -n YOUR-NAMESPACE\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[e._v("Edit the deployment YAML and add the environment variable to point to the K8s Secret.")])]),e._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("-env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" ENTANDO_TENANTS\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("valueFrom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("secretKeyRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" entando"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("tenants"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("secret\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" ENTANDO_TENANTS              \n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("optional")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[e._v("false")]),e._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[e._v("Scale the deployment back up to 1 or more replicas:")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("kubectl scale deploy/YOUR-APP-NAME-deployment --replicas=1 -n YOUR-NAMESPACE\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[e._v("Confirm that the secondary tenant is working correctly. This may include testing the EntandoApp itself (including digital assets delivered via CDS), the AppBuilder, and enterprise search for Solr. The tutorials for each service include verification steps that can be followed once the tenant configuration is fully in place.")])]),e._v(" "),a("h2",{attrs:{id:"bundles"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bundles"}},[e._v("#")]),e._v(" Bundles")]),e._v(" "),a("p",[e._v("Once tenants are in order, "),a("RouterLink",{attrs:{to:"/next/docs/curate/bundle-details.html"}},[e._v("Entando Bundles")]),e._v(" can be deployed independently to each tenant from registries added in the App Builder. Bundles can be centralized in an "),a("RouterLink",{attrs:{to:"/next/tutorials/solution/entando-hub.html"}},[e._v("enterprise Entando Hub")]),e._v(" where all tenants can access them by "),a("RouterLink",{attrs:{to:"/next/tutorials/solution/entando-hub.html#add-a-catalog-registry"}},[e._v("adding the registry")]),e._v(" in the Local Hub of the App Builder.")],1),e._v(" "),a("p",[e._v("When bundles are installed to any tenant, the Component Manager injects an "),a("code",[e._v("ENTANDO_TENANT_CODE")]),e._v(", an environment variable related to the tenant domain name, into every microservice, identifying which tenant it belongs to.")]),e._v(" "),a("p",[e._v("To create or adapt bundles for multitenant applications, environment variables can be leveraged in the bundle descriptor to customize bundles. Microservices can be specified with an embedded or internal SQL DBMS, but if an "),a("RouterLink",{attrs:{to:"/next/tutorials/consume/external-db-ms.html"}},[e._v("external database")]),e._v(" is required, a plugin configuration Secret will need to be configured.")],1),e._v(" "),a("ul",[a("li",[a("RouterLink",{attrs:{to:"/next/tutorials/create/pb/publish-simple-bundle.html"}},[e._v("Create and Publish a Bundle project")])],1),e._v(" "),a("li",[a("RouterLink",{attrs:{to:"/next/docs/curate/bundle-details.html"}},[e._v("Learn about Entando Bundles")])],1),e._v(" "),a("li",[a("RouterLink",{attrs:{to:"/next/tutorials/solution/entando-hub.html"}},[e._v("Add an enterprise Entando Hub")])],1),e._v(" "),a("li",[a("RouterLink",{attrs:{to:"/next/tutorials/solution/entando-hub.html#add-a-catalog-registry"}},[e._v("Add a Registry to you Local Hub")])],1),e._v(" "),a("li",[a("RouterLink",{attrs:{to:"/next/tutorials/consume/external-db-ms.html"}},[e._v("Configure External DBMS for Microservices")])],1)]),e._v(" "),a("h2",{attrs:{id:"appendix"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#appendix"}},[e._v("#")]),e._v(" Appendix")]),e._v(" "),a("h3",{attrs:{id:"liquibase-options"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#liquibase-options"}},[e._v("#")]),e._v(" Liquibase Options")]),e._v(" "),a("p",[e._v("Liquibase is the default for database management for multitenancy on Entando, but this process can be modified with the following methods.")]),e._v(" "),a("p",[a("strong",[e._v("Apply the Strategy in the App Engine Deployment")])]),e._v(" "),a("p",[e._v("Use this specification in the "),a("code",[e._v("entando-de-app")]),e._v(" image to set the strategy for all tenants, including the primary and secondary tenants.")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("db.migration.strategy")]),e._v(": \"skip|disabled|auto|generate_sql\" # defaults to 'auto' which uses Liquibase to initialize checks and updates on the DBs")])]),e._v(" "),a("p",[a("strong",[e._v("Apply the Strategy for Secondary Tenants")]),a("br"),e._v("\nFor a secondary tenant, the "),a("code",[e._v("dbMigrationStrategy")]),e._v(" value in the "),a("code",[e._v("entando-tenant-secret.yaml")]),e._v(" can be modified to specify its behavior.")]),e._v(" "),a("ul",[a("li",[a("p",[a("code",[e._v("dbMigrationStrategy")]),e._v(": \"skip|disabled|auto|generate_sql\" # default is 'skip'; to skip the entire Liquibase process of checking databasechangelog tables and changeSetFiles")])]),e._v(" "),a("li",[a("p",[e._v("If "),a("code",[e._v("dbMigrationStrategy")]),e._v(" is not present inside the tenant configuration, it looks for the value in the "),a("code",[e._v("db.migration.strategy")]),e._v(" system property.")])])]),e._v(" "),a("h3",{attrs:{id:"tenant-domains"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tenant-domains"}},[e._v("#")]),e._v(" Tenant Domains")]),e._v(" "),a("p",[e._v("A tenant can have multiple fully qualified domain names (FQDNs), as long as they are defined in the "),a("code",[e._v("fqdns")]),e._v(" field of the tenant configuration secret. This field determines which tenant's configuration to use when an incoming request is made to the Entando Application.")]),e._v(" "),a("p",[e._v("Example:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('"fqdns": "www.YOUR-HOST-NAME,blog.YOUR-HOST-NAME,news.YOUR-HOST-NAME"\n')])])]),a("h3",{attrs:{id:"tomcat-options"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tomcat-options"}},[e._v("#")]),e._v(" Tomcat Options")]),e._v(" "),a("p",[e._v("Entando's multitenancy application uses the Tomcat servlet container and provides a few optional parameters.")]),e._v(" "),a("p",[a("strong",[e._v("Enabling a Java Agent for Tomcat")]),a("br"),e._v("\nTo use a Java agent with your application, use initContainers with a PVC (PersistenVolumeClaim) to prepare the JAR file with the information required for the agent. Add the following environment variables to the "),a("code",[e._v("entando-de-app-tomcat")]),e._v(" deployment to activate the agent and provide the agent code from the JAR file.")]),e._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("AGENT_ENABLED")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"true"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# if true, adds the agent options to tomcat, defaults to false")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("AGENT_OPTS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"-javaagent:~/YOUR-JARFILE.jar"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# the jar file with the agent options to use, defaults to empty  ")]),e._v("\n")])])]),a("p",[a("strong",[e._v("Manage Upload File Size Limitations")]),a("br"),e._v("\nAdd these environment variables to the "),a("code",[e._v("entando-de-app-tomcat")]),e._v(" deployment to customize the application-server and file upload maximum sizes.")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("For the Tomcat application server, use "),a("code",[e._v("TOMCAT_MAX_POST_SIZE")]),e._v(" to configure connector maxPostSize; the default value is 209,715,200 bytes. Enter the value in bytes.")])]),e._v(" "),a("li",[a("p",[e._v("For the application, use "),a("code",[e._v("FILE_UPLOAD_MAX_SIZE")]),e._v(" to configure the upload limit; the default value is 52,428,800 bytes. Enter the value in bytes.")])])])],1)}),[],!1,null,null,null);t.default=s.exports}}]);