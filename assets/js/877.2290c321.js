(window.webpackJsonp=window.webpackJsonp||[]).push([[877],{2239:function(e,t,a){"use strict";a.r(t);var s=a(36),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"solr-integration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#solr-integration"}},[e._v("#")]),e._v(" Solr Integration")]),e._v(" "),a("p",[e._v("Solr is an enterprise search platform with full-text search, real-time indexing, dynamic clustering, database integration, and rich document handling. Solr can be integrated into applications built on Entando and is required for multitenant architecture.")]),e._v(" "),a("p",[e._v("This tutorial describes the installation steps for Solr integration, including the generation of the core collection which consists of the index and configuration files. For multitenant applications, a core collection must be generated for the primary or first tenant, and each of the secondary tenants.")]),e._v(" "),a("h2",{attrs:{id:"prerequisites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),a("ul",[a("li",[a("RouterLink",{attrs:{to:"/v7.3/docs/getting-started/"}},[e._v("A working instance of Entando")]),e._v(" based on the default Tomcat server image")],1),e._v(" "),a("li",[e._v("Verify dependencies with the "),a("RouterLink",{attrs:{to:"/v7.3/docs/getting-started/entando-cli.html"}},[e._v("Entando CLI")]),e._v(": "),a("code",[e._v("ent check-env develop")])],1),e._v(" "),a("li",[a("a",{attrs:{href:"https://helm.sh/docs/intro/install/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Helm"),a("OutboundLink")],1),e._v(" to handle the Solr installation")])]),e._v(" "),a("h2",{attrs:{id:"install-and-configure-solr"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install-and-configure-solr"}},[e._v("#")]),e._v(" Install and Configure Solr")]),e._v(" "),a("ol",[a("li",[e._v("Install Solr Helm charts:")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" apache-solr https://solr.apache.org/charts\nhelm repo update\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[e._v("Install the Solr and Zookeeper CRDs."),a("br"),e._v(" "),a("strong",[e._v("Note:")]),e._v(" Creating the CRDs and installing the operators are done at the cluster level and will require cluster-level permissions.")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl create -f https://solr.apache.org/operator/downloads/crds/v0.5.0/all-with-dependencies.yaml\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[e._v("Install the Solr and Zookeeper operators:")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("helm "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" solr-operator apache-solr/solr-operator --version "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0.5")]),e._v(".0\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[e._v("Download the template "),a("code",[e._v("entando-solrCloud.yaml")]),e._v(". Adjust the resource settings such as memory, CPU, storage, or replicas using this file.")])]),e._v(" "),a("EntandoCode",[e._v('curl -sLO "https://raw.githubusercontent.com/entando/entando-releases/'+e._s(e.$site.themeConfig.entando.fixpack.v73)+'/dist/ge-1-1-6/samples/entando-solrCloud.yaml"')]),e._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[e._v("Create the Solr application resources:")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl apply -f entando-solrCloud.yaml -n YOUR-NAMESPACE\n")])])]),a("ol",{attrs:{start:"6"}},[a("li",[e._v("Check that the service started properly:")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl get solrclouds -w\n")])])]),a("p",[e._v("You should see a response similar to this:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("NAME   VERSION   TARGETVERSION   DESIREDNODES   NODES   READYNODES   UPTODATENODES   AGE\nsolr   "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("8")]),e._v("                         "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("              "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("            "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("               79m\n")])])]),a("h2",{attrs:{id:"generate-the-core"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#generate-the-core"}},[e._v("#")]),e._v(" Generate the Core")]),e._v(" "),a("ol",[a("li",[e._v("Set up port forwarding to the Solr common service:")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl port-forward service/solr-solrcloud-common "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("8983")]),e._v(":80\n")])])]),a("p",[a("strong",[e._v("Note:")]),e._v(" "),a("code",[e._v("kubectl port-forward")]),e._v(" should be left running.")]),e._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[e._v("Open another terminal and call the Solr API to generate the Solr core collection."),a("br"),e._v(" "),a("strong",[e._v("Note:")]),e._v(" the first core (the primary tenant in a multitenant environment, or the only core in a single tenant environment) must use "),a("code",[e._v("YOUR-TENANT-NAME")]),e._v('="entando" for the collection name below.')])]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[e._v("Placeholder")]),e._v(" "),a("th",{staticStyle:{"text-align":"left"}},[e._v("Description")])])]),e._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("YOUR-TENANT-NAME")]),e._v(" "),a("td",{staticStyle:{"text-align":"left"}},[e._v("The identifying name of the current tenant. In most cases, it will also be used to determine the base URL of the tenant. For example, yoursite results in yoursite.your-domain.com.")])])])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"http://localhost:8983/solr/admin/collections?action=CREATE&name=YOUR-TENANT-NAME&numShards=1&replicationFactor=3&maxShardsPerNode=2"')]),e._v("\n")])])]),a("blockquote",[a("p",[e._v("The number of shards and shards per node should be adjusted for very large quantities of content, such as 50k or more. In such cases, adjustments to replicas and other resources may be needed.")])]),e._v(" "),a("h2",{attrs:{id:"configure-the-entandoapp-deployment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-entandoapp-deployment"}},[e._v("#")]),e._v(" Configure the EntandoApp Deployment")]),e._v(" "),a("ol",[a("li",[e._v("Scale down the EntandoApp deployment to 0:")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl scale deploy/YOUR-APP-NAME-deployment --replicas"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" -n YOUR-NAMESPACE\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[e._v("Edit the deployment and add the following environment variables:")])]),e._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" SOLR_ACTIVE\n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"true"')]),e._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" SOLR_ADDRESS\n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("//solr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("solrcloud"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("common/solr \n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[e._v("Scale the "),a("code",[e._v("entando-de-app")]),e._v(" deployment back up to 1 or more deployments:")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl scale deploy/YOUR-APP-NAME-deployment --replicas"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" -n YOUR-NAMESPACE\n")])])]),a("h2",{attrs:{id:"generate-the-solr-schema"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#generate-the-solr-schema"}},[e._v("#")]),e._v(" Generate the Solr Schema")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("When a new core is added to Solr, its schema also needs to be generated. This is done automatically for the first or primary collection. But for secondary collections, it must be triggered manually by clicking "),a("code",[e._v("Refresh")]),e._v(" next to each content type under "),a("code",[e._v("App Builder")]),e._v(" → "),a("code",[e._v("Content")]),e._v(" → "),a("code",[e._v("Solr Configuration")]),e._v(".")])]),e._v(" "),a("li",[a("p",[e._v("Reindex the content using "),a("code",[e._v("App Builder")]),e._v(" → "),a("code",[e._v("Content")]),e._v(" → "),a("code",[e._v("Settings")]),e._v(" → "),a("code",[e._v("Reload the indexes")]),e._v(".")])]),e._v(" "),a("li",[a("p",[e._v("Confirm Solr is configured and the index is working correctly by using the "),a("code",[e._v("Search Form")]),e._v(" widget to confirm Content items can be found via search. This widget is automatically placed in the header of a "),a("RouterLink",{attrs:{to:"/v7.3/docs/compose/welcome-wizard.html"}},[e._v("page created via the Welcome Wizard")]),e._v(". For example, searching for "),a("code",[e._v("platform")]),e._v(" should return at least one result with the default content set.")],1)])]),e._v(" "),a("h2",{attrs:{id:"options"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#options"}},[e._v("#")]),e._v(" Options")]),e._v(" "),a("h3",{attrs:{id:"direct-access-to-solr-configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#direct-access-to-solr-configuration"}},[e._v("#")]),e._v(" Direct Access to Solr Configuration")]),e._v(" "),a("p",[e._v("The Solr configuration page can be accessed directly from the "),a("code",[e._v("Content")]),e._v(" menu list in the App Builder. The configuration page allows you to monitor and update the schema and reload the indexes for each searchable type.")]),e._v(" "),a("p",[e._v("To enable this option, set the environment variable "),a("code",[e._v("advancedSearch")]),e._v(" specification to "),a("code",[e._v("true")]),e._v(" in the EntandoApp deployment YAML.")]),e._v(" "),a("p",[a("strong",[e._v("Resources")])]),e._v(" "),a("ul",[a("li",[e._v("Go to the "),a("a",{attrs:{href:"https://artifacthub.io/packages/helm/apache-solr/solr-operator",target:"_blank",rel:"noopener noreferrer"}},[e._v("Solr Operator"),a("OutboundLink")],1),e._v(" resource page for additional information.")]),e._v(" "),a("li",[e._v("See the "),a("a",{attrs:{href:"https://solr.apache.org/guide/7_3/solr-tutorial.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Solr Getting Started page"),a("OutboundLink")],1),e._v(" for more information.")])])],1)}),[],!1,null,null,null);t.default=r.exports}}]);