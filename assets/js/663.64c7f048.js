(window.webpackJsonp=window.webpackJsonp||[]).push([[663],{1923:function(t,e,a){"use strict";a.r(e);var s=a(36),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"backing-up-and-restoring-an-entando-application"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#backing-up-and-restoring-an-entando-application"}},[t._v("#")]),t._v(" Backing Up and Restoring an Entando Application")]),t._v(" "),a("h2",{attrs:{id:"overview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[t._v("#")]),t._v(" Overview")]),t._v(" "),a("p",[t._v("This tutorial demonstrates how to use an existing Entando Application as a launching point for creating new applications. An alternative is to "),a("RouterLink",{attrs:{to:"/v7.0/tutorials/create/pb/export-bundle-from-application.html"}},[t._v("use the Entando Bundler")]),t._v(" to extract specific content and functionality from an existing application. Entando Bundles are recommended as a more flexible option when a full copy of an application is not required.")],1),t._v(" "),a("h2",{attrs:{id:"prerequisites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[t._v("#")]),t._v(" Prerequisites")]),t._v(" "),a("ul",[a("li",[t._v("Java 11")]),t._v(" "),a("li",[t._v("Docker")]),t._v(" "),a("li",[t._v("Maven")]),t._v(" "),a("li",[t._v("Access to a Docker repository (docker.io or other)")])]),t._v(" "),a("h2",{attrs:{id:"create-a-backup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-a-backup"}},[t._v("#")]),t._v(" Create a Backup")]),t._v(" "),a("p",[t._v("This step requires using a running Entando environment to take an application backup.\nThe output of this step is a local directory with the files (database and static assets) needed to restore the application later.")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Log into the App Builder")])]),t._v(" "),a("li",[a("p",[t._v("Go to "),a("code",[t._v("Administration â†’ Database")])])]),t._v(" "),a("li",[a("p",[t._v("Click on "),a("code",[t._v("Create A Backup")]),t._v(" and wait for the process to complete. The static assets and database backup will be saved to a persistent volume on the server pod under "),a("code",[t._v("/entando-data")]),t._v(".")])]),t._v(" "),a("li",[a("p",[t._v("Transfer the files from the "),a("code",[t._v("server-deployment")]),t._v(". The exact command will depend on your Kubernetes environment.")])])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("kubectl")]),t._v(" "),a("th",[t._v("OpenShift")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("kubectl cp <pod>:<path> <local-path>")])]),t._v(" "),a("td",[a("code",[t._v("oc rsync <pod>:<path> <localPath>")])])]),t._v(" "),a("tr",[a("td",[t._v("e.g. "),a("code",[t._v("kubectl cp quickstart-deployment-7b8c699599-f84zq:/entando-data backup")])]),t._v(" "),a("td",[t._v("e.g."),a("code",[t._v("oc rsync app-entando-deployment-67fd5b9954-s72mb:/entando-data")])])])])]),t._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[t._v("You should see 3 directories - "),a("code",[t._v("databases")]),t._v(", "),a("code",[t._v("protected")]),t._v(", and "),a("code",[t._v("resources")]),t._v(".\nThe "),a("code",[t._v("protected")]),t._v(" directory contains the timestamped backup you triggered from the App Builder. The "),a("code",[t._v("resources")]),t._v(" directory contains the static assets.")])]),t._v(" "),a("h2",{attrs:{id:"restore-a-backup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#restore-a-backup"}},[t._v("#")]),t._v(" Restore a Backup")]),t._v(" "),a("p",[t._v("Restoring a backup requires creating and then deploying a custom image of an Entando Application with the\nbackup files included.")]),t._v(" "),a("h3",{attrs:{id:"build-the-custom-image"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#build-the-custom-image"}},[t._v("#")]),t._v(" Build the Custom Image")]),t._v(" "),a("ol",[a("li",[t._v("Clone the Entando Application repository")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/entando/entando-de-app\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Change into the "),a("code",[t._v("entando-de-app")]),t._v(" directory:")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" entando-de-app\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("(Optional) Checkout a branch for your desired Entando version. You can review "),a("a",{attrs:{href:"https://github.com/entando/entando-de-app/releases",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/entando/entando-de-app/releases"),a("OutboundLink")],1),t._v(" to determine the correct tag to use.")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" checkout -b my-test v7.0.0\n")])])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("If you don't perform this step, you'll be creating an Entando Application based on the latest "),a("code",[t._v("entando-de-app")]),t._v(" code, which may not yet be released.")])]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[a("p",[t._v("Move the "),a("code",[t._v("resources")]),t._v(" and "),a("code",[t._v("protected")]),t._v(" directory from your Entando backup into "),a("code",[t._v("src/main/webapp")]),t._v(". You should override any existing content.")])]),t._v(" "),a("li",[a("p",[t._v("Build the application")])])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("mvn clean package\n")])])]),a("ol",{attrs:{start:"6"}},[a("li",[a("p",[t._v("Create a repository named "),a("code",[t._v("entando-de-app-wildfly")]),t._v(" in Docker for the new application. The Entando Operator will expect this name when performing the initial install.")])]),t._v(" "),a("li",[a("p",[t._v("Create a Docker image for the application. You'll need to provide your user name and version.")])])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" -f Dockerfile.wildfly -t YOUR-"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("USER")]),t._v("/entando-de-app-wildfly:YOUR-VERSION\n")])])]),a("ol",{attrs:{start:"8"}},[a("li",[t._v("Push the image to Docker")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" push YOUR-"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("USER")]),t._v("/entando-de-app-wildfly:YOUR-VERSION\n")])])]),a("h3",{attrs:{id:"install-the-application"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install-the-application"}},[t._v("#")]),t._v(" Install the Application")]),t._v(" "),a("p",[t._v("You can use your typical install steps (or the standard "),a("RouterLink",{attrs:{to:"/v7.0/docs/getting-started/#manual-install"}},[t._v("Manual Install steps")]),t._v(") with one adjustment. When you get to the "),a("code",[t._v("Install namespace scoped resources")]),t._v(" step, you'll need to configure the "),a("code",[t._v("namespace-resources.yaml")]),t._v(" to use your image.")],1),t._v(" "),a("ol",[a("li",[t._v("Retrieve a copy of the "),a("code",[t._v("namespace-resources.yaml")]),t._v(" for your Entando version")])]),t._v(" "),a("EntandoCode",[t._v("curl -sfL https://raw.githubusercontent.com/entando/entando-releases/"+t._s(t.$site.themeConfig.entando.fixpack.v70)+"/dist/ge-1-1-6/namespace-scoped-deployment/namespace-resources.yaml > namespace-resources.yaml")]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Edit "),a("code",[t._v("namespace-resources.yaml")]),t._v(" and update the "),a("code",[t._v("entando-de-app-wildfly")]),t._v(" configuration with your user name and version")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("entando-de-app-wildfly")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v('"version"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"YOUR-VERSION"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v('"executable'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('type"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jvm"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v('"registry"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker.io"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v('"organization"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"YOUR-USER"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("Now apply the namespace resources to K8s")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" kubectl apply -n entando -f namespace-resources.yaml\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[a("p",[t._v("You can now continue with the rest of the install instructions")])]),t._v(" "),a("li",[a("p",[t._v("Once deployed, review the App Builder or running application to confirm the backup was restored correctly. You can check the deployment logs for possible errors.")])])])],1)}),[],!1,null,null,null);e.default=n.exports}}]);