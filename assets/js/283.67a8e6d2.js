(window.webpackJsonp=window.webpackJsonp||[]).push([[283],{1922:function(e,t,a){"use strict";a.r(t);var o=a(36),r=Object(o.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"backing-up-and-restoring-keycloak"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#backing-up-and-restoring-keycloak"}},[e._v("#")]),e._v(" Backing Up and Restoring Keycloak")]),e._v(" "),o("p",[e._v("This tutorial describes how to backup an active Entando Identity Management Keycloak instance and restore it in another environment.")]),e._v(" "),o("h2",{attrs:{id:"prerequisites"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites:")]),e._v(" "),o("p",[e._v("A Keycloak instance running on Entando with a database management system (DBMS) in the backend. This procedure will not work with an embedded database.")]),e._v(" "),o("h2",{attrs:{id:"create-a-backup-of-keycloak-realm"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#create-a-backup-of-keycloak-realm"}},[e._v("#")]),e._v(" Create a Backup of Keycloak Realm")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("From the command line, get the pod name of the Keycloak server you wish to back up. In a quickstart environment, the pod name will begin with "),o("code",[e._v("default-sso-in-namespace-deployment")]),e._v(".")])]),e._v(" "),o("li",[o("p",[e._v("Use kubectl to start a bash shell in the pod:")])])]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v(" kubectl exec -it YOUR-KEYCLOAK-POD-NAME -- /bin/bash\n")])])]),o("ol",{attrs:{start:"3"}},[o("li",[e._v("Create a new directory in /tmp with:")])]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("mkdir -p /tmp/export \n")])])]),o("ol",{attrs:{start:"4"}},[o("li",[e._v("Run the following script to retrieve the data for the Entando realm and save it to a JSON file in the "),o("code",[e._v("export")]),e._v(" directory. A new Keycloak server will run on a different port (offset=200) to avoid conflicts with the original Entando Keycloak instance.")])]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("/opt/jboss/keycloak/bin/standalone.sh -Djboss.socket.binding.port-offset=200 -Dkeycloak.migration.action=export  -Dkeycloak.migration.provider=singleFile  -Dkeycloak.migration.realmName=entando -Dkeycloak.migration.usersExportStrategy=DIFFERENT_FILES -Dkeycloak.migration.file=/tmp/export/entando-prod-realm.json\n")])])]),o("ol",{attrs:{start:"5"}},[o("li",[e._v("If there are no errors, press Ctrl+C to stop the process.")]),e._v(" "),o("li",[e._v("Type "),o("code",[e._v("exit")]),e._v(" to close the bash shell in the pod.")]),e._v(" "),o("li",[e._v("Execute this command to copy the realm data file to the proper location:")])]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("kubectl cp YOUR-KEYCLOAK-POD-NAME:/tmp/export/ keycloak-backup\n")])])]),o("h2",{attrs:{id:"import-the-keycloak-realm"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#import-the-keycloak-realm"}},[e._v("#")]),e._v(" Import the Keycloak Realm")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Login to the new Entando Keycloak server where the realm is to be restored.")])]),e._v(" "),o("li",[o("p",[e._v("From the left sidebar, go to "),o("code",[e._v("Import")]),e._v(".")])]),e._v(" "),o("li",[o("p",[e._v("Click "),o("code",[e._v("Select file")]),e._v(" button and "),o("code",[e._v("upload")]),e._v(" the JSON file from the "),o("code",[e._v("keycloak-backup")]),e._v(" directory. You will see the following page:")])])]),e._v(" "),o("p",[o("img",{attrs:{src:a(983),alt:"Entando ID Management UI"}})]),e._v(" "),o("ol",{attrs:{start:"4"}},[o("li",[e._v("You have now successfully imported the Keycloak realm to a new environment.")])]),e._v(" "),o("div",{staticClass:"custom-block tip"},[o("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),o("p",[e._v("If you are using a different environment, with a different hostname, you should import only users or set the flag for "),o("code",[e._v("If a resource exists")]),e._v(" to "),o("code",[e._v("Skip")]),e._v(".")])])])}),[],!1,null,null,null);t.default=r.exports},983:function(e,t,a){e.exports=a.p+"assets/img/import-keycloak.a966146c.png"}}]);