<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tutuorial: how to configure custom datasources and connections for Entando Apps on EAP and Wildfly</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="Entando Docs">
    <link rel="preload" href="/docs/assets/css/0.styles.45470058.css" as="style"><link rel="preload" href="/docs/assets/js/app.d6c7c024.js" as="script"><link rel="preload" href="/docs/assets/js/2.e917390b.js" as="script"><link rel="preload" href="/docs/assets/js/44.5ea4eaa4.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.8c31897f.js"><link rel="prefetch" href="/docs/assets/js/11.cd86610c.js"><link rel="prefetch" href="/docs/assets/js/12.e7a8f70d.js"><link rel="prefetch" href="/docs/assets/js/13.94e715e4.js"><link rel="prefetch" href="/docs/assets/js/14.2dae19f9.js"><link rel="prefetch" href="/docs/assets/js/15.2aecd405.js"><link rel="prefetch" href="/docs/assets/js/16.c0895e54.js"><link rel="prefetch" href="/docs/assets/js/17.da7cde27.js"><link rel="prefetch" href="/docs/assets/js/18.fba830aa.js"><link rel="prefetch" href="/docs/assets/js/19.ccf1b8c2.js"><link rel="prefetch" href="/docs/assets/js/20.5f2ae127.js"><link rel="prefetch" href="/docs/assets/js/21.b0811fd3.js"><link rel="prefetch" href="/docs/assets/js/22.9874cc16.js"><link rel="prefetch" href="/docs/assets/js/23.639b95c5.js"><link rel="prefetch" href="/docs/assets/js/24.9ddd3b2a.js"><link rel="prefetch" href="/docs/assets/js/25.8d854b0d.js"><link rel="prefetch" href="/docs/assets/js/26.61de2afe.js"><link rel="prefetch" href="/docs/assets/js/27.ce685cf4.js"><link rel="prefetch" href="/docs/assets/js/28.a6bbfcc8.js"><link rel="prefetch" href="/docs/assets/js/29.a8df8aef.js"><link rel="prefetch" href="/docs/assets/js/3.c5aed261.js"><link rel="prefetch" href="/docs/assets/js/30.26715a38.js"><link rel="prefetch" href="/docs/assets/js/31.8362bf35.js"><link rel="prefetch" href="/docs/assets/js/32.33e8681e.js"><link rel="prefetch" href="/docs/assets/js/33.428f9b1b.js"><link rel="prefetch" href="/docs/assets/js/34.81cfdc19.js"><link rel="prefetch" href="/docs/assets/js/35.2d9e98f9.js"><link rel="prefetch" href="/docs/assets/js/36.86a3cb13.js"><link rel="prefetch" href="/docs/assets/js/37.9026c830.js"><link rel="prefetch" href="/docs/assets/js/38.fa135d76.js"><link rel="prefetch" href="/docs/assets/js/39.1c6b86f5.js"><link rel="prefetch" href="/docs/assets/js/4.b2bdd888.js"><link rel="prefetch" href="/docs/assets/js/40.91f8bfcb.js"><link rel="prefetch" href="/docs/assets/js/41.9c9ffdb7.js"><link rel="prefetch" href="/docs/assets/js/42.95b2c78c.js"><link rel="prefetch" href="/docs/assets/js/43.a9733c1e.js"><link rel="prefetch" href="/docs/assets/js/45.1c50f1eb.js"><link rel="prefetch" href="/docs/assets/js/46.027db281.js"><link rel="prefetch" href="/docs/assets/js/47.7f5176a2.js"><link rel="prefetch" href="/docs/assets/js/48.04e41c98.js"><link rel="prefetch" href="/docs/assets/js/49.3229e997.js"><link rel="prefetch" href="/docs/assets/js/5.2cb12f0b.js"><link rel="prefetch" href="/docs/assets/js/50.889a81cd.js"><link rel="prefetch" href="/docs/assets/js/51.c89e704e.js"><link rel="prefetch" href="/docs/assets/js/52.c616829f.js"><link rel="prefetch" href="/docs/assets/js/53.3b099fe0.js"><link rel="prefetch" href="/docs/assets/js/54.98842abe.js"><link rel="prefetch" href="/docs/assets/js/55.4eb4f4e9.js"><link rel="prefetch" href="/docs/assets/js/6.67b36152.js"><link rel="prefetch" href="/docs/assets/js/7.5973d6f1.js"><link rel="prefetch" href="/docs/assets/js/8.af418605.js"><link rel="prefetch" href="/docs/assets/js/9.f0abdb17.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.45470058.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="/docs/entando-labs.svg" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://docs.entando.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://forum.entando.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Forum
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.entando.com/page/en/modern_applications_blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://www.entando.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Entando.com
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/entando" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/entando/entando-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://docs.entando.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://forum.entando.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Forum
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.entando.com/page/en/modern_applications_blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://www.entando.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Entando.com
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/entando" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/entando/entando-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/docs/" class="sidebar-link">Overview</a></li><li><a href="/docs/getting-started/" class="sidebar-link">Getting Started</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Platform Capabilities</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Concepts</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/release-notes/" class="sidebar-link">Release Notes</a></li><li><a href="/docs/old-versions/" class="sidebar-link">Old Versions</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tutuorial-how-to-configure-custom-datasources-and-connections-for-entando-apps-on-eap-and-wildfly"><a href="#tutuorial-how-to-configure-custom-datasources-and-connections-for-entando-apps-on-eap-and-wildfly" class="header-anchor">#</a> Tutuorial: how to configure custom datasources and connections for Entando Apps on EAP and Wildfly</h1> <h2 id="purpose"><a href="#purpose" class="header-anchor">#</a> Purpose</h2> <p>This tutorial explains how to customize our EAP and Wildfly base Docker images, and then configure the EntandoApp
custom resource to use these customizations</p> <h2 id="requirements"><a href="#requirements" class="header-anchor">#</a> Requirements</h2> <ul><li><p>The Entando Operator is running in the target names</p></li> <li><p>Keycloak and the Entando Cluster Infrastructure have been deployed</p></li> <li><p>The required external databases and other services are up and running.</p></li> <li><p>Your own custom project as described in <a href="/docs/app-engine/building-prepackaged-image.html">the tutorial</a></p></li></ul> <h2 id="steps"><a href="#steps" class="header-anchor">#</a> Steps</h2> <h3 id="_1-create-a-docker-project-for-your-own-base-image-to-entando-s-standard-base-image-s"><a href="#_1-create-a-docker-project-for-your-own-base-image-to-entando-s-standard-base-image-s" class="header-anchor">#</a> 1. Create a Docker project for your own base image to Entando's standard base image(s)</h3> <p>Create a project, ideally in Git repository, and put the following files in the folder</p> <h4 id="_1-1-the-standalone-xml-standalone-openshift-xml-file-of-choice"><a href="#_1-1-the-standalone-xml-standalone-openshift-xml-file-of-choice" class="header-anchor">#</a> 1.1. The standalone.xml/standalone-openshift.xml file of choice</h4> <p>It is essential for your custom Docker image to use a file from one of the official Entando Docker base images.</p> <p>If you intend to use provide your own EAP based image, please use this
<a href="https://github.com/entando/entando-docker-base-images/blob/master/entando-eap71-clustered-base/standalone-openshift.xml" target="_blank" rel="noopener noreferrer">standalone-openshift.xml<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
file.</p> <p>If you intend to use provide your own Wildfly based image, please use this
<a href="https://github.com/entando/entando-docker-base-images/blob/master/entando-wildfly12-base/contrib/wildfly-configuration/standalone.xml" target="_blank" rel="noopener noreferrer">standalone.xml<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
file.</p> <p>Please note that if you create your own base image with a different version of EAP or Wildfly, using these files
may have unintended consequences.</p> <h4 id="_1-2-any-modules-that-may-be-required-for-your-datasource-or-other-connection-resource"><a href="#_1-2-any-modules-that-may-be-required-for-your-datasource-or-other-connection-resource" class="header-anchor">#</a> 1.2. Any modules that may be required for your datasource or other connection resource</h4> <p>If the resource you need to connect to requires some custom classes, such as JDBC drivers, please add these as<br>
a module to Wildfly/EAP. As an example, you can look at our
<a href="https://github.com/entando/entando-docker-base-images/tree/master/entando-base-common/wfmodules/org/apache/derby/jdbc/main" target="_blank" rel="noopener noreferrer">Derby database module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
that Entando uses for embedded databases. Please ensure that the path of the folder containing the jar files reflects
the fully qualified name of the module in the module.xml file.</p> <h4 id="_1-3-dockerfile"><a href="#_1-3-dockerfile" class="header-anchor">#</a> 1.3 Dockerfile</h4> <p>In your Dockerfile, please be sure to extend the correct base image, and add the correct configuration file to
the correct location in the target image.</p> <p>For EAP, a most basic Dockerfile would look like this:</p> <div class="language- extra-class"><pre class="language-text"><code>FROM entando/entando-eap71-clustered-base:6.1.2
COPY --chown=185:0 ./standalone-openshift.xml /opt/eap/standalone/configuration
</code></pre></div><p>For Wildfly, a most basic Dockerfile would look like this:</p> <div class="language- extra-class"><pre class="language-text"><code>FROM entando/entando-eap71-clustered-base:6.1.2
COPY --chown=1001:0 ./standalone.xml /wildfly/standalone/configuration
</code></pre></div><p>Please take note of the user ownership in these different Dockerfiles. This is quite important as Openshift will
expect the user/group ownership to be respected.</p> <h3 id="_2-customize-the-standalone-xml-standalone-openshift-xml-file-using-environment-variables"><a href="#_2-customize-the-standalone-xml-standalone-openshift-xml-file-using-environment-variables" class="header-anchor">#</a> 2. Customize the standalone.xml/standalone-openshift.xml file using environment variables.</h3> <p>You can now modify your Wildfly/EAP configuration to meet your requirements. Where the configuration could differ
from one environment to a next, we strongly advise using environment variable expressions (<code>${env.VAR_NAME}</code>). The most likely change
that would be required in this file is the addition of a datasource. Here is an example of how to add a datasource
to the datasources subsystem. All the environment variables starting with 'YOURDB' can be specified from the Docker
container.</p> <div class="language- extra-class"><pre class="language-text"><code>   ...
    &lt;subsystem xmlns=&quot;urn:jboss:domain:datasources:5.0&quot;&gt;
      &lt;datasources&gt;
        &lt;datasource jndi-name=&quot;${env.YOURDB_JNDI}&quot; enabled=&quot;true&quot; use-java-context=&quot;true&quot; pool-name=&quot;yourDbDataSource&quot; use-ccm=&quot;true&quot;&gt;
          &lt;connection-url&gt;${env.YOURDB_URL}&lt;/connection-url&gt;
          &lt;driver&gt;${env.YOURDB_DRIVER}&lt;/driver&gt;
          &lt;security&gt;
            &lt;user-name&gt;${env.YOURDB_USERNAME}&lt;/user-name&gt;
            &lt;password&gt;${env.YOURDB_PASSWORD}&lt;/password&gt;
          &lt;/security&gt;
        &lt;/datasource&gt;
</code></pre></div><p>Please take extra care not to remove any lines from these files. This is of particular importance in the case of the
EAP image as, on startup, scripts in the official EAP look for certain placeholders in this file and populates them
from other environment variables.</p> <h3 id="_3-build-your-own-docker-base-image"><a href="#_3-build-your-own-docker-base-image" class="header-anchor">#</a> 3. Build your own Docker base image</h3> <p>You can now build your Docker base image. It is highly recommended that you consider using a dedicated CI/CD build
tool such as Jenkins X to build the base image and maintain traceability between your source code and the resulting
Docker image. One possible build command could look like this:</p> <p><code>docker build . -t your-docker-registry.com/your-org/your-base-image:1.0.0</code></p> <h3 id="_4-modify-your-entando-app-project-to-use-the-new-docker-base-image"><a href="#_4-modify-your-entando-app-project-to-use-the-new-docker-base-image" class="header-anchor">#</a> 4. Modify your Entando App project to use the new Docker base image</h3> <p>You can now modify your Entando App project that you have forked as described in the
<a href="/docs/app-engine/build-core-image.html">relevant tutorial</a>. You would require two changes to the pom.xml file
of the sample project.</p> <ul><li>Firstly, you would need to change the variable <code>server.base.image</code> to reflect the fully
qualified URI of your Docker image for EAP and/or Wildfly. For example, if you decided to extend the Wildfly image,
go to the Maven profile with the id <code>wildfly</code> and change the  <code>server.base.image</code> to look like this:</li></ul> <p><code>&lt;server.base.image&gt;your-docker-registry.com/your-org/your-base-image:1.0.0&lt;/server.base.image&gt;</code></p> <ul><li>Then you need to change the <code>&lt;from&gt;</code> element in the Fabric8 Maven Docker Plugin to reflect this variable.
Navigate to the first <code>&lt;image&gt;</code> element in the pom.xml file. You have found the correct one
if it contains the following xml:</li></ul> <p><code>&lt;from&gt;entando/${server.base.image}:${entando.version}&lt;/from&gt;</code></p> <p>Delete the <code>entando/</code> prefix and the <code>:${entando.version}</code> suffix:</p> <p><code>&lt;from&gt;${server.base.image}&lt;/from&gt;</code></p> <p>Please note that, should you still require support for both Wildfly and EAP in your Maven pom, you may need to
repeat this exercise for both the <code>eap</code> and <code>wildfly</code> profiles.</p> <h3 id="_5-build-and-push-your-custom-docker-image"><a href="#_5-build-and-push-your-custom-docker-image" class="header-anchor">#</a> 5. Build and push your custom Docker image</h3> <p>Before building your Docker image, it would be a good idea to change the name of the image you want to build. Navigate
to the previously modified <code>&lt;image&gt;</code> element in the Fabric8 Maven Docker Plugin.You can change the <code>&lt;name&gt;</code> element
to reflect your preferred name, e.g.</p> <p><code>&lt;name&gt;your-docker-registry.com/your-org/your-entando-app:1.0.0&lt;/name&gt;</code></p> <p>Run:</p> <p><code>mvn clean package -Pwildfly -Pderby</code></p> <p>A new Docker image should now be available named <code>your-docker-registry.com/your-org/your-entando-app:1.0.0</code></p> <p>Log into the Docker registry in question and then push the image:</p> <p><code>docker push your-docker-registry.com/your-org/your-entando-app:1.0.0</code></p> <p>You are now ready to deploy this image.</p> <h3 id="_6-deploy-your-entandoapp-with-the-correct-environment-variables"><a href="#_6-deploy-your-entandoapp-with-the-correct-environment-variables" class="header-anchor">#</a> 6. Deploy your EntandoApp with the correct environment variables</h3> <p>The final step is to configure your EntandoApp deployment with the correct environment variables. As is the case with
all the Entando Custom Resources that result in actual deployments, the property <code>spec.parameters</code> will be translated
into environment variables on each of the Containers in the Deployment's Pod. For an EntandoApp named 'my-app',
the new state of the EntandoApp would could be placed in a file named <code>my-app.yaml</code> that would look something like this:</p> <div class="language- extra-class"><pre class="language-text"><code>      kind: &quot;EntandoApp&quot;
      metadata:
        name: &quot;my-app&quot;
      spec:
        dbms: postgresql
        replicas: 1
        customServerImage: your-docker-registry.com/your-org/your-entando-app:1.0.0
        ingressPath: /your-entando-app
        parameters:
          YOURDB_JNDI: java/your-ds
          YOURDB_URL: jdbc:postgresql://somehost.com:5432/mydb
          YOURDB_DRIVER: postgresql
          YOURDB_USERNAME: my_user
          YOURDB_PASSWORD: mypassword
      entandoStatus:
        entandoDeploymentPhase: requested

</code></pre></div><p>Notice how this Custom Resource specifies a <code>parameter</code> for each environment variable that was referenced from the
<code>standalone.xml</code> file referenced earlier.</p> <p>To apply the changes to your deployment, change the <code>entandoStatus.entandoDeploymentPhase</code> property to requested and
apply the file:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl apply -f my-app.yaml
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/entando/entando-docs/edit/master/vuepress/docs/k8s-operator/tutorials/how-to-configure-custom-datasource.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/18/2020, 8:47:56 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.d6c7c024.js" defer></script><script src="/docs/assets/js/2.e917390b.js" defer></script><script src="/docs/assets/js/44.5ea4eaa4.js" defer></script>
  </body>
</html>
